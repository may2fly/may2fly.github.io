---
layout: post
title: 计算广告
categories: 读书笔记
---

## 1、在线广告综述
在线广告指的是在线媒体上投放的广告。在线广告已经形成了以人群为投放目标、以产品为导向的技术型投放模式。

从数据的角度来看，在线广告开启了大规模、自动化地利用数据改善产品和提高收入的先河。

### 1、大数据与广告的关系
大数据问题的特性，即4V特征：

* Volume(规模)
* Variety(多样性)
* Velocity (高速)
* Value(价值)

从实际操作的角度看什么是大数据问题：
> 如果有的数据处理问题无法通过数据采样的方法来降低处理的复杂程度，就 必须利用一些专门为海量数据处理而设计的计算和存储技术(如 MapReduce、NoSQL 数 据库等)来实现。

计算广告是非常典型的大数据应用。计算广告为各行各业大数据的落地提供了非常有价值的借鉴范本:

1. 计算广告为规模化地将用户行为数据转化为可衡量的商业价值提供了完整产品线和解决方案，并且实际上创造了互联网行业大部分的营收。
2. 在线广告孕育和孵化了较为成熟的数据加工和交易产业链，并对其中的用户隐 私边界有深入探讨，这值得所有涉及用户数据的互联网应用学习和借鉴。
3. 由于有了商业上的限制条件，计算广告的技术和产品逻辑比单纯的个性化系统 更加复杂周密。因此，理解在线广告的产品和市场对于设计正确有效的商业产品大有益处。

### 2.广告的定义和目的
广告是由已确定的出资人通过各种媒介进行的有关产品(商品、服务和观点)的，通
常是有偿的、有组织的、综合的、劝服性的非人员的信息传播活动。

广告的根本目的是广告主通过媒体达到低成本的用户接触。

* 需求方(demand)：广 告主(advertiser)、代表广告主利益的代理商(agency)或其他技术形态的采买方
* 供给方(supply)：媒体，或其他技术形态的变现平台。

出资人、媒体和受众这三者的利益博弈关系是广告活动永远的主线，这一主线将贯穿于商业和产品形态的整个演化过程。

品牌广告(brand awareness)：借助媒体的力量来快速接触大量用户，以达到宣传品牌 形象、提升中长期购买率与利润空间的目的
直接效果广告(direct response)：利用广告手段马上带来大量的购买或其他转 化行为

互联网广告兼有品牌和效果两方面的功能。要确定广告是否真的成本较低，需要用到投入产出比 (Return On Investment，ROI)这一评价指标，即某次广告活动的总产出与总投入的比例。

一切付费的信息、产品或服务的传播渠道，都是广告。

### 3、在线创意广告
用户接触的创意形式简要介绍：

1. 横幅广告(banner ad)：一般是嵌入在页面中相对固定位置的图片，需要占据固定的版面。因此，这种广告一般要 有底层的备选广告素材，以防没有合适的广告匹配时页面上开天窗。
2. 文字链广告(textual ad)：一段链接到广告主落地页的文字，在搜索广告中为主流形式，同时在展示广告中也被广泛采用。可以占据固定的版面，也可以穿插在大量内容链接条目中。
3. 富媒体广告(rich media ad)：利用视觉冲击力较强的表现形式，在不占用固定版面位置的情况下，向用户侵入式地投送广告素材。常见的形式 有弹窗、对联、全屏等。
4. 视频广告(video ad)：在视频流播放的间隙插入的广告也成为互联网广告的一种重要形式。视频广告可以分为前插片、后插片、暂停等类型。前插片广告一般采用短视频的形
式；暂停广告则与普通的横幅广告区别不大。
5. 社交广告(social ad)：在社交网络环境下嵌入的广告，最典型的形式是插入在社交网络信息流中的广告。
6. 移动广告(mobile ad)：典型的形式有横幅、 开屏、插屏、积分墙或推荐墙等
7. 邮件定向营销广告(E-mail Direct Marketing，EDM)：通过电子邮件的方 式向目标用户传递推广信息的一种网络营销手段。

### 4、在线广告简史
20 世纪末，在线媒体诞生，产生了在线广告供给方。广告代理通过合约售卖方式展示广告。 
> 合约广告： 采用合同约定的方式确定某一广告位在某一时间段为某特定广告主所独占，并且根据双方的要求，确定广告创意和投放策略。

根据受众类型投放广告，即定向广告(targeted advertising)。遵循按千次展示付费(Cost per Mille，CPM)的计费方式。
> 计算技术产生了两个具体需求:一是受众定向(audience targeting)，即通过技术手段标定某个用户的性别、年龄或其他标签;二是广告投放(ad serving)，即将广告投送由直接嵌入页面变为实时响应前端请求，并根据用户标签自动决策和返回合适的广 告创意。
> 
> 媒体向广告主保证某个投放量，并在此基础上确定合同的总金额以及投放量未完成情况下的赔 偿方案。这种担保式投送(Guaranteed Delivery，GD)的交易方式逐渐成为互联网合约式 广告的主要商业模式。

竞价广告 (auction-based advertising)，供给方只向广告主保证质即单位流量的成 本，但不再以合约的方式给出量的保证，换言之，对每一次展示都基本按照收益最高的原 则来决策。
> 搜索广告(search ad)：根据用户的即时兴趣定向投送的广告，而即时兴趣的标签就是关键词。将用户的即时兴趣标签由搜索词换成正在浏览页面中的关键词，便产生了上下文广告(contextual advertising)。

基于竞价机制和精准人群定向这两个核心功能，在线广告分化出了广告网络(ad Network，ADN)这种新的市场形态。它批量地运营媒体的广告位资源，按照人群或上下 文标签售卖给需求方，并用竞价的方式决定流量分配。广告网络的结算以按点击付费(Cost per Click，CPC)的方式为主，

由于只能在 ADN 定义好的定向标签组合上预先指定出价，而不能控制每一次展示的出价，因此，市场看起来像一个黑盒子，需求方只能靠选择合适的标签组合以及阶段性调整出价来间接控制效果。面向多个ADN或媒体按人群一站式采买广告并优化投入产出比的需求方产品，我们称为交易终端(Trading Desk， TD)。

市场上产生了大量聚合各媒体的剩 余流量并采用实时竞价方式为他们变现的产品形态——广告交易平台(ad Exchange，ADX)。通过实时竞价的方式，按照定制化的人群标签购买广告，这样的产品就是需求方平台 (Demand Side Platform，DSP)。基于DSP的广告采买非常类似于股票市场上的程序交易，我们把这样的广告采买方式也叫 作程序化交易(programmatic trade)。

LUMA Partners图谱的骨架是从两端向中间逐渐发展和形成的:首先是合约阶段， 广告主通过代理公司从媒体方采买广告，而媒体方的广告投放机则负责完成和优化各个广 告主的合约;然后，市场进化出了竞价售卖方式，从而在靠近供给方产生了 ADN 这样的产品形态，而需求方的代理公司为了适应这一市场变化，孵化除了对应的媒介采买平台 (media buying platform);最后，当市场产生了实时竞价方式交易时，供给方进化出了 ADX，而需求方则需要用 DSP 与其对接来出价和投送广告。

在在线广告发展的历史上，定向技术和交易形式的进化是一条主线。从最初的固定位置合约交易发展到进行受众定向、按展示量结算的合约交易，再到竞价交易方式，并最终发展成开放的实时竞价交易市场。这条主线的核心驱动力是让越来越多的数据 源为广告决策提供支持，从而提升广告的效果。

产品展现逻辑是另外的发展线路:在展示广告的最初阶段，广告位作 为与内容相对独立的单元来决策和运营，并且完全以优化收入为目标；将内容与广告以某种方式统 一决策或排序的广告产品——原生广告(Native AD)。

### 5、泛广告商业产品
泛广告商业产品的本质都是付费推广。

1. 团购。团购本质上是一种按照效果付费的泛广告产品，其特殊性在于广告主除
了付推广费用外，还向用户让利以获得转化。
2. 游戏联运。游戏联运根据用户的最终游戏内消费在推广渠道和游戏开发商之间 分成的商业产品。
3. 固定位导航。包括网址导航站的位置入口、应用分发平台的推荐位置等付费推广位置。
4. 返利购买。采用折扣或积分的方式激励用户购买。

当一个公司同时运营普通广告和上述一种或多种泛广告产品时，它们之间甚至是和用户产品之间，经常会出现争夺广告位或其他入口资源的问题。

## 2、计算广告基础
可衡量的效果以及相应的计算优化是在线广告区别 于线下广告的主要特点。计算广告核心问题，即利润优化问题的概念性框架。

在线广告多种多样的计费方式实际上反映着市场结构的分工不同。

### 1、广告有效性原理
按照方便计算广告讨论的原则，用一个三段式信息传播模型来解剖广告由物理 上产生到最终产生转化行为的全过程：

```
选择(selection)——>解释 (interpretation)——>态度(attitude)

可以细化为：
曝光(exposure)——> 关注(attention)——>理解(comprehension)——>接受(acceptence)——>保持(retention)——>决策(decision)
```

1. 曝光(exposure)阶段：广告物理上展现出来的过程。“位置为王”
2. 关注(attention)阶段：受众从物理上接触到广告到意识上注意 到它的过程。
> 当用户明确辨识出某个固定不变的广告位，并且不再认为它与自己当浏览网页的任务有关联时，他会下意识地屏蔽其中的内容。 明确传达向用户推送此广告的原因；内容符合用户的兴趣或需求

3. 理解(comprehension)阶段
> 首先，广告内容要在用户能理解的具体兴趣范围内， 这说明了真正精准的受众定向有多么必要。其次，要注意设定与关注程度相匹配的理解门槛。
4. 接受(acceptence)阶段
5. 保持(retention)阶段：广告传 达的信息给用户留下长久的记忆，以影响他长时间的选择
6.  决策(decision)阶段：成功广告的最终作用是带来用户的转化行为

### 2、互联网广告的技术特点
在线广告市场的特点：

1. 技术和计算导向。数字媒体的特点使在线广告可以进行精细的受众定向，而技 术又使得广告决策和交易朝着计算驱动的方向发展。
2. 效果的可衡量性。曝光率、点击率
3. 创意和投放方式的标准化。标准化的驱动力来自于受众定向与程序购买。
4. 媒体概念的多样化。从需求方看在线广告时，应该注重各种性质媒体的配合关系，并从整合营销的角度去审视和优化整体的效果。
5. 数据驱动的投放决策。互联网化的根本驱动力可以认为是数据的深入加工和利用。广泛收集用户的行为数据和广告反馈数据，利用云计算的基础设施 对用户打上合适的标签，同样根据数据在多个广告竞争同一次展示时作出决策，再将投放 的结果统计数据反馈给广告操作人员以调整投放策略，这已经成为在线广告的基本投放逻 辑。

现代的在线广告系统就是一个大数据处理平台，而且其对数据处理的 规模和响应速度的要求都相当高。
 
### 3、计算广告的核心问题
计算广告的核心问题，是为一系列用户与环境的组合找到最合适的广告投放策略以优
化整体广告活动的利润。

**1、广告收入的分解**

当用户在媒体页面的广告位上曝光后，首先产生的是点击行为，广告点击与广告展现的比率称为点击率(Click Through Rate，CTR)；落地页成功打开次数与点击次数的比例称为到达率；如果用户从落地页开始，进一步完成下单等操作，则称为转化，转化次数与到达次数的比例称为转化率(Conversion Rate，CVR)，

按照媒体网站和广告主网站上的行为段对回报 r 进行分解，

```
//用μ表示点击率，用ν表示点击价值(click value)，即单次点击为广告产品带来的收益。
eCPM = r(a, u, c) = μ(a, u, c) · v(a, u, c) 
```
eCPM 一般指的是估计的千次展示收益。

**2、结算方式与 eCPM 估计的关系**
根据 eCPM 的分解决定哪部分由谁来估计是广告市场各种计费模式产生的根本原因。市场上主要的几种广告计费模式：

* CPM 结算，即按照千次展示结算。供给方与需求方约定好千次展示 的计费标准，至于这些展示是否能够带来相应的收益，由需求方来估计和控制其中的风险。
* CPC 结算，即按点击结算。点击率的估计是由交给供给方(或者 中间市场)完成的。点击价值的估计则由需求方完成，并通过点击出价的方式向市场通知自己的估价。
* CPS(cost per sale)/CPA(cost per action)/ROI 结算，即按照销售订单数、转 化行为数或投入产出比来结算。
* CPT(cost per time)结算，将某个广 告位以独占式方式交给某广告主，并按独占的时间段收取费用的方式。

综合来看可以认为，对于效果广告，CPC 计费方式最有利于发挥供给方和需求方的长处，因而在市场上被广泛接受;对于品牌广告， 由于效果和目的有时不便于直接衡量，可以考虑按照 CPM 的方式计费;而 CPS 的计费方 式只在一些特定的环境下才比较合理。

### 4、在线广告相关行业协会
**1、交互广告局iab.**
> 交互广告局(Interactive Advertising Bureau，IAB，http://www.iab.net)成立于 20 世纪末，是在线广告领域最重要的行业协会，其使命是致力于推动在线广告市场的发展。
> IAB 主要关注的是在 线广告供给方的利益。

包括如下几个重要的规范。

1. 横幅广告创意尺寸标准。2001 年 IAB 公布的标准仅仅支持 7 种创意尺寸，即 120×600(摩天大楼)、160×600(宽摩天大楼)、180×150(长方形)、300×250(中 级长方形)、336×280(大长方形)、240×400(竖长方形)、250×250(正方形弹出)。 创意尺寸的统一化，对于在线广告市场淡化广告位概念、推广受众定向有着非常根本的促 进作用。
2. 视频广告标准 VAST(digital video ad serving template)。IAB 制定了一套统一的 XML Schema 用于向在线视 频媒体投放视频流内的广告，并对其用户进行规范化的描述。
3. 通用实时竞价接口标准 OpenRTB。IAB 制定了统一的 OpenRTB 标准，将横幅广告、视频广告、移动 广告情形下的实时竞价接口做了统一的规范。

**2、美国广告代理协会**
美国国家广告商协会(Association of National Advertisers，ANA)是一个广告主的协会。
会员多是 AT&T、宝洁(P&G)以及 NBA 等 这些拥有大量广告预算的广告主。


## 3、在线广告产品概览
(1)合约广告产品:由线下广告的交易形式衍生而来，又可以分为按照时段售卖的 CPT 广告和按照约定展示量售卖的CPM广告。

(2)竞价广告产品:如搜索广告，其产品形式为对搜索关键词的竞价。这种广告在拓展到站外展示广告流量时，演进成了对页面关键词或者用户标签竞价的产品形式。

(3)程序化交易广告产品:竞价广告的进一步发展催生了实时竞价的交易形式。实时竞价使得需求方可以更灵活地划分和选择自己的目标受众，也使得更广泛的数据使用和交易迅速发展起来。以实时竞价为核心的一系列交易方式逐渐演变为机器之间以程序化的
方式完成广告交易决策，因此，这类产品称为程序化交易广告产品。

(4)原生广告产品:广告的产品体系除了自身的演进，另一个重要课题是如何处理 与非商业化内容的关系，让广告与内容尽可能以“原生”的方式共存。搜索广告和社交网络 信息流广告对此作了非常有价值的探索，不过这样的原生广告在规模化和交易化方面也遇 到了很多的问题。然而，随着近年来移动设备对于原生广告的强烈渴求，像标准 ADN 那样 的原生广告平台正在快速发展中。

每种广告产品形态，都会有三个主要的组成部分:面向需求方的接口、面向供给方的接口、中间的投放系统及匹配策略。

### 1 、商业产品的设计原则
商业产品指的是面向商业客户而非一般用户的产品，其中最典型的代表就是互联网广 告产品。如客户关系管理(Customer Relation Management，CRM)、网站分析(Web Analytics，WA)以及数据管理平台 (Data Management Platform，DMP)等

互联网是一个产品驱动的行业。用户产品演进的根本驱动力是人们追求方便的天性。用户产品的设计原则总是朝着更简单、更直观、更快捷的方向努力。而相应的产品设计重点也集中在关键功能的突出、操作过程的流畅等方面。

在优化既定商业目标这一商业产品的总体原则下，运营过程的关键点：

(1)相对于产品功能，要特别关注产品中的策略部分。

(2)要特别关注数据，让运营和产品优化形成闭环。

(3)用户产品追求便捷性的设计原则依然非常重要。不过实现功能以外过于新奇、炫酷的产品外观和交互模式是应当避免的。

### 2、需求方层级组织与接口
需求方提供的广告是分层次管理的。广告的层次分为广告主、广告(推广)计划(campaign)、广告(推广)组(ad goup)、广告创意(creative)等几个层级，

* 广告计划概念上对应于广告主的一次投放合同，其中包括了预算、时间范围等
基本信息。
* 广告组对应于一个具体的广告投放策略，主要是设定受众定向条件和出价。
* 广告创意则是最终展示出来的素材，可能在同一个组策略下有不同尺寸的创意
存在。

对于投放规模很大的广告主或代理，广告平台一般会提供与界面功能相对应的 API 接口。以便于用编程的方式进行批量投放和优化。

### 3、供给方管理接口
供给端的资源组织主要分媒体和广告位两个层次。添加、删除广告位以及查看各广告位的运 营数据是主要的功能需求。

## 4、合约广告
线下广告的商业逻辑也被照搬到了线上，由广告代理公司和媒体签订协议，确保 某些广告位在某时间段为指定的广告商所占有，同时广告商按整体合同支付广告费用。

合约式广告的重点是按 CPM 计费的展示量合约广告。这种方式仍然以合同的方式确定 一次广告活动的投放总量和展示单价，但是售卖的对象已经由“广告位”进化到了“广告位+ 人群”。

### 1、广告位合约
广告位合约是指媒体和广告主约定在某一时间段 内、在某些广告位上固定投送该广告主的广告，相应的结算方式为 CPT。这种方式的缺点非常明显， 即无法做到按受众类型投放广告，因而也无法进行深入的效果优化。

按照广告位的轮播售卖，用户对同一个广告位的一系列访问，被依次标上一组循环的轮播顺序号，将其中具有同样顺序号的展示作为一个虚拟的广告位，售卖给广告主。

### 2、受众定向
大多数广告产品的基础是按照受众售卖。因此，受众定向是其非常重要的支持技术。

在考察某种定向方法时，主要有两个方面的性能需要 关注:

* 一是定向的效果，即符合该定向方式的流量上高出平均 eCPM 的水平;
* 二是定向的 规模，即这部分流量占整体广告库存流量的比例。

**1、受众定向方法概览**
对受众定向的一些典型方法：

1. 地域定向(geo-targeting)：可以认为是一种上下文定向，是一种不可或缺的流量选择手段。
2. 人口属性定向(demographical targeting)。人口属性的 主要标签包括年龄、性别、教育程度、收入水平等。可以用采样加调研的方法来判断一次人口属性定向广告活动受众 中有多少比例是正确的。
3. 频道定向(channel targeting)：是完全按照供应方的内容分类体系将库存按照频道划分，对各频道的流量投送不同的广告。
4. 上下文定向(contextual targeting)：根据网页的具体内容来匹配相关的广告，这就是上下文定向。上下文定向的效果在不同类别的内容上有很大的区别。
5. 行为定向(behaviorial targeting)：其框架是根据用户的历史访问行为了解用户兴趣，从而投送相关广告。行为定向的框架、算法和评价指标也就奠定了在线广告数据驱动的本质特征，并催生了相关的数据加工和交易的衍生业务。
6. 精确位置定向(hyper-local targeting)：投放精准定位的广告
7. 重定向(retargeting)：对某个广告主过去一段时间的访客投放广告以提升效果。
8. 新客推荐定向(look-alike targeting )：思路是根据 广告主提供的种子访客信息，结合广告平台更丰富的数据，为广告主找到行为上相似的潜在客户。
9. 团购(group-purchase)：团购也是一种变相的广告形式。

**2、受众定向标签体系**
标签体系有两种组织方式:一种是按照某个分类法(taxonomy)制定一个层次标签体系， 其中上层的标签是下一层的父节点，在人群覆盖上是包含关系。另外一种兴趣标签的组织方式，是根据广告主的具体需求设置相应的标签。

选择结构化兴趣标签体系还是非结构化的兴趣标签体系更多地是商业上的决策，

还有一种特殊的标签形式，即关键词。直接按照搜索或浏览内容的关键词划分人群和
投放广告，往往可以达到比较精准的效果。

### 3、展示量合约
展示量合约指的是 约定某种受众条件下的展示量，然后按照事先约定好的单位展示量价格来结算。

从交易模式上来看，展示量合约仍然是比较传统的交易模式。但从技术层面，这种模式的出现实际上已经反映了互联网广告计算驱动的本质:分析得到用户和上下文的属性，并由服务端根据这些属性及广告库情况动态决定广告候选。这一商业模式的出现需要受众定向、流量预测和担保式投放等技术手段的支持。

**1、流量预测**
展示量合约售卖的是某特定人群上的广告曝光次数，在产品策略上就产生了流量预测(traffic forecasting)。
流量预测在广告产品中主要用途:
(1)售前指导。事先尽可能准确地预 测各人群标签的流量变得非常关键。
(2)在线流量分配。各种在线分配算法都要依赖流量预估的结果，以达到高效和准确的目标。
(3)出价指导。

广告里一般的流量预测问题，可以描述成对流量 t(u，b)这个函数的估 计，其中第一个参数 u 是给定的人群标签或人群标签的组合，第二个参数 b 是出价。在 展示量合约中，由于没有竞价，可以看成是上述问题在 b→∞情形下的特例。

**2、 流量塑形**
主动地影响流量，以利于合约的达成。这一产品策略问题称为流量塑形 (traffic shaping)。

从商业产品的要求来看，要系统化、高效率地达到流量塑形的目标，需要用户产品与广告产品的需求情况打通，然后按照一定的准则，在不伤害用户体验的情形下，尽可能提高商业变现的效率。

**3、在线分配**
在线分配需要根据历史数据和某种策略离线得到一个分配方案，线上则照此方案执行。

随着标签数量的增加，供给节点的数量会以指数速度上升，而每一个供给节点的流量当然也就迅速收缩。当节点的流量过小时，对其进行相对准确的预测就变得相当困难，这时上面所说的方案就会变得完全不可行。

## 5、搜索与竞价广告
竞价交易模式的本质是将量 的约束从交易过程中去除，仅仅采用“价高者得”的简单决策方案来投放每一次广告。

搜索广告在竞价广告乃至整个在线广告中都有着旗舰产品的地位。一些在计算广告中非常核心的产品策略和技术方案
都来源于搜索广告。

广告网络中竞价的标的物有两种:一 是上下文页面中的关键词，这是直接从搜索广告衍生而来的;二是根据用户行为加工的兴 趣标签，这是从展示广告的定向逻辑发展而来的。

### 1、搜索广告
搜索广告是广告主就某标的物(在这里是关键词) 的广告展示机会展开拍卖式的竞争，并根据竞争结果依次占据该广告展示的若干位置。

**搜索广告产品形态**
搜索广告是以上下文查询词为粒度进行受众定向，并按照竞价方式售卖和CPC结算的 广告产品。

搜索广告最基本的形式是与自然检索结果一致的文字链，一般会加底色和角上的“推 广”“推广链接”“Ads”等字样。
搜索广告的产品和技术特点：

* 搜索广告的变现能力，即 eCPM 远远高于一般的展示广告，用户主动输入的查询直接反映了用户的意图
* 搜索广告的受众定向标签，即是上下文的搜索查询。
* 搜索广告的展示形式与自然结果的展示形式非常接近
* 从搜索广告发展起来的竞价交易模式已经逐渐发展成为互联网广告最主流的交 易模式。

**搜索广告产品新形式**
搜索广告的探索趋势：

1. 丰富文字链创意的展示形式让其更富表现力以提高点击率。
2. 利用东区对相关性要求稍低的特点设计一些拓展广告产品。
3. 优化广告与自然结果的关系在保证相关性和广告效果的前提下提高收入。

**搜索广告产品策略**
在搜索广告中，排序的依据，即 eCPM，可以简单地表示成` r(a，c)=μ (a，c)·bidCPC(a)`。

1、查询扩展
搜索引擎会提供一些将广告中的关键词匹配到更多相关查询的服务。常见的几种匹配方式：精确匹配、短语匹配、广泛匹配、否定匹配。

2、广告放置
当广告候选完成排序以后，需要分别确定北区和东区的广告条数，这个环节称为广告 放置(ad placement)。
北区是黄金的广告展示位置，对于搜索广告的收入至关重要。

### 2、位置拍卖与机制设计
1.广义第二高价(GSP)

所谓第二高价，指的是在只有一个位置 的拍卖中，向赢得该位置的广告主收取其下一位广告主的出价，这样的拍卖也叫作 Vickrey 拍卖。

对赢得每一个位置的广告主，都按照他下一位的广告位置出价来收取费用，这 就是广义第二高价。

2.VCG

其基本思想是:对于赢得了某个位置的广告主，其所付出 的成本应该等于他占据这个位置给其他市场参与者带来的价值损害。

VCG 定价策略的优越性体现：
> 首先，在这种定价策略的稳定状态下，整个市场是 truth-telling 的。 所谓 truth-telling，可以理解为每个广告主都找到了自己的最优状态。其次，相对于其他 的定价策略，这种定价向广告主收取的费用是最少的。


竞价广告市场往往要设置一个赢得拍卖 位置的最低价格，这一价格我们称为市场保留价，俗称“起价”或“底价”。

### 3、广告网络
广告网络的产品功能是批量聚合各媒体的剩余流量，按照人群或上下 文标签的流量切割方式售卖给广告主。

**广告网络产品形态**
广告网络产品其实有两个来源:一方面来源于搜索引擎发展出来的上下文广告产品，即根据页面中提取的关键词来投放广告;另一方面来源于展示广告的兴趣标签向精细化发展后。

竞价广告网络的产品特点：

竞价方式不向广告主做量的约定，而是根据变现能力，即 eCPM，来决定每次展 示分配给哪个广告主。
由于是按人群售卖，广告网络会极力淡化媒体和广告位的概念。
从商业角度来看，广告网络的销售模式与合约的方式相比也有两点优势:首先 是无需再满足广告主品牌独占的要求，其次，由于广告网络 根据实际消耗来结算

**广告网络产品策略**
广告网络在广告检索和排序 两个环节上面临的问题比搜索更加通用。

1、广告检索
展示广告网络由于用户意图不明确，我们往往要将更多的关键字、兴趣标签同时用于检索过程，而实践也证明，使用更多的标签对于提高效果是有直接帮助的。

2、广告排序
广告网络中的 CTR 预测有两方面的困难。首先，点击数据更加稀疏，而且需要同时考虑上下文和用户量方面的信息。其次，广告网络中由于广告位的差别巨大，点击率的变动范围 很大，这使得稳健地估计点击率变得相对困难。

### 竞价广告需求方产品
**搜索引擎营销**
搜索广告对应的需求方产品，即通过竞价采买搜索引擎关键词来做推广，这就是搜索 引擎营销，即 SEM。关键词选择和出价两个问题都有相当的难度。

**媒体购买平台**
面向展示广告网络的一站式采买平台称为媒介采买平台。媒体采买平台的技术挑战 主要在于ROI的优化部分，要合理地选择需要的受众定向条件，并在每个人群上优化出价， 以保证量的要求和优化收益是一个复杂的组合优化问题。

### 竞价广告与合约广告的比较
从供给方或广告市场方来看，在合约广告的情况下，所有量的保证和质的优化都是由媒体方的广告投放机来统一完成，而在竞价广告的情况下，市场只负责制定竞价和收费的规则，而各广告主量的保证完全采用市场竞争的方式来完成。

从需求端来看，合约广告的采买方式对广告主来说缺乏透明性。竞价广告中供给方不再向广告主承诺广告投放量，点击单价由广告主自行决定。

## 6、程序化交易广告
市场的发展方向是提供广告主自行选择流量和在每次展示上独立出价的功能。这就产生了以实时竞价即 RTB 为核心的程序化交易市场。

从需求方来看，出价需求的存在和广告主预算范 围内的套利要求 DSP 具备点击率预测、点击价值估计、流量预测、站外推荐等多方面的运 算能力。

在需求方的利益得到了充分的保证以后，媒体的变现手段也发生了相应的变化。媒体有四种常用的广告变现选择:担保式投送的合约售卖方式、自营广告网络、托管给其他广告网络、通过 RTB 变现。

### 实时竞价
用定制化标签指导广告投放是实时竞价的关键产品目标。实时竞价的接口可以分成两个过程，即预先进行的将 ADX 与 DSP 的用户标识对应起 来的 cookie 映射(cookie mapping)过程和线上广告请求时的竞价和投放过程，

### 其他程序化交易方式
在实时竞价产生以后，广告交易越来越多地依赖机器间在线的协商而非事先约定或人
工操作完成，这样的交易方式称为程序化交易。程序化交易的核心目的是让需求方能够自
由地选择流量和出价。

**优选**

优选方式允许单个需求方按照自己的意愿来挑选流量，但是又可以避免复杂的竞价过程。

1. 用户浏览媒体网站。
2. 媒体网站通过 JavaScript 代码或 SDK 向供给方广告投放机发起广告请求;这里的供给方广告投放机有时是媒体自己的广告投放机，有时则是 ADX 的广告投放机。
3. 供给方广告投放机向需求方的广告投放机发起请求，询问是否需要此次广告展示机会。
4. 需求方广告投放机根据自己的逻辑判断，如果需要此次展示机会，则返回相应 的广告创意。
5. 需求方如果不需要此次展示机会，则通知媒体广告投放机，由供给方广告投放 机从自有广告库中选择合适的创意返回。

**私有市场**

私有市场可以说兼顾了优选与实时竞价的好处:首先，它是一种邀请制而非公开的交易方式，因此广告主的质量可以由少量被邀请需求方很好地控制，这有利于确保媒体的价值不受伤害;其次，在被邀请需求方之间仍然保留了竞价了关系，有利于提升媒体的变现能力。

**广告交易方式谱系**

按时间段和广告位独占式的售卖以及展示量合约的售卖是销售与客户之间将广告投放的关键要求约定下来的交易方式，在高质量的媒体上属于优先考虑的售卖方式，称为优先销售。

按照一些准则或计算结果灵活地对不同的流 量分割选择不同的 ADN，这称为网络优化(network optimization)。

### 广告交易平台
广告交易平台，即 ADX，它负责将媒体流量以拍卖的 方式售卖给DSP。

实时竞价中广告决策是由 DSP 完成的，而且对每次展示都 可以得到广告位信息。因此，虽然各个广告位的点击率差别很大，DSP 还是可以自行精细 估计点击率，并实时计算出当前展示的合理 eCPM。

### 需求方平台
以 RTB 方式购买广告的产品形态就是需求方平台，即DSP。核心特征有两个:一个是 RTB 方式的流量购买，另一个是需要支持需求方定制化的用 户划分。

**需求方平台产品策略**

DSP的广告决策过程，要经过检索、排序、定价几个阶段。在实时竞价环境中，出价直接决定着 DSP 的流量基本单位成本， 当然也就决定着利润。

**出价策略**
DSP 直觉的出价策略比较简单:只要 eCPM 估计足够精准，并按照此值出价即可。

DSP 优化的出价策略可以定性地描述为:首先，通过历史的观察和预测得到市价的曲线;然后，将一天的预算分配到那些市价较低的流量上。

**重定向**
重定向即把那些曾经对广告主服务发生明确兴趣的用户找出来，向他们投放该广告主的广告。

重定向主要有两种目的，用于品牌广告和用于效果广告

网站重定向(site retargeting)，即将在一段时间内到达过广告主网站的用户作为重定向集合。个性化重定向(personalized retargeting)是网站重定向的一种特例。对重定向流量 进行深入加工，按照品类和购买阶段等因素进行创意上的深度个性化，就是个性化重定向。

个性化重定向关键点：

* 动态创意：用推荐的思路实时决定展示什么商品
* 推荐引擎：站外推荐
* 广告主商品库存实时接口：个性化重定向服务需要 提供准实时的商品库接口，让广告主可以及时地将库存和价格信息同步过来

搜索重定向(search retargeting)，即将搜索过与广告主直接相关的关键词的用户群 作为重定向集合。
确定合适的搜索重定向词表的思路：

* 人工根据经验确定词表。
* 如果该广告主同时也在做 SEM，可以直接采用对应投放的关键词表。
* 基于广告主流量统计的方法，即统计广告主网站流量中从搜索引擎来的流量，将其中频度较高的关键词作为搜索重定向词表。

**新客推荐**

通过标签加工策略称为新客推荐，即 look-alike。

### 供给方平台
广告请求是被分配到自运营广告库，还是其他广告 网络，或者是 DSP，是根据他们的收益在线动态决定的，这样的方案称为动态分配(dynamic allocation)。对应的产品形态就叫作供给方平台(Supply Side Platform，SSP)。

**供给方平台产品策略**

SSP 中多种广告源动态分配的决策过程如下：

1. 从自有广告库中根据当前受众标签检索合适的广告候选，并估计每个广告候选 的 eCPM。
2. 排序得到 eCPM 最高的广告候选以及相应的 eCPM 值 r<sub>MAX</sub>。
3.  同样根据环境信息和受众标签估算出各个合作的广告网络大致的 eCPM。
4.  排序得到 eCPM 最高的广告网络以及相应的 eCPM 值r<sup>'</sup><sub>Max</sub>
5. 以 max(r<sub>Max</sub>,r<sup>'</sup><sub>Max</sub>)为底价，通过 RTB 接口向各个合作的 DSP 查询更高变现价值的广告

SSP 涉及的计算问题是其中的网络优化问题，即对某次展示机会的(u，c)对 N 个候 选的广告网络估计其 eCPM 以优化收益。在实践策略中考虑的因素主要有两个:一个是广告网络或 DSP 的分成模式和比例; 另一个是它们各自的广告返回率。

### 数据加工与交易
要提高定向的精准程度与人群覆盖率，数据的来源与质量是决定性的。技术能力的高低直接影响着数据采集和变现的有效性。

**有价值的数据来源**

对精准广告业务有直接贡献的数据：

* 用户标识：稳定精确的用户身份对准确界定受众和利用数据至关重要。
* 用户行为：转化(conversion)、预转化(pre-conversion)、 搜索广告点击(sponsored search click)、展示广告点击(ad click)、搜索点击(search click)、 搜索(search)、分享(share)、页面浏览(page view)、广告浏览(ad view)等在线 行为是可以被广泛采集并且对于受众定向或广告决策有明确作用。

> 按照对效果广告的有效 性分类，这些行为可以分为决策行为、主动行为、半主动行为和被动行为。
> 
> 决策行为主要包括转化和预转化。
> 
> 主动行为主要包括广告点击、搜索和搜索点击。
> 
> 半主动行为主要包括分享和网页浏览。

* 人口属性：人口属性本身是常用的一种定向标签
* 地理位置：地理位置信息随着能获得的精度不同其用途也会有相当大的差异。广告定向，对于餐饮等受地理位置限制极大的线下业务广告商是非常有价值的。
* 社交关系：社交网络上的关系反映了人与人之间的联系，也隐含了“兴趣相似”的合理推测。

**三方数据划分**

广告中用到的用户数据，根据其来源的不同可以分为第一方数据、第二方数据和第三方数据。

第一方和第二方分别是指广告主和广告平台。不直接参与广告交易的其他数据提供方统称为第三方。


**数据管理平台**
第一方数据的收集和加工的产品称为数据管理平台即 DMP，核心的产品功能如下：

* 它可以为网站提供受众定向功能，并将得到的用户标签应用于网站业务。
* 如果媒体网站授权，DMP 可以提供接口对加工出来的用户标签进行变现，并与 网站进行分成。
* 广告主网站可以通过 DMP 与广告采买渠道进行更方便的数据对接。

**数据交易平台**
数据交易平台(data exchange)的主要产品功能是聚合各种来源的在线的用户行为数 据，加工成有价值的用户标签，然后在广告市场上通过售卖这些标签来变现。

数据 交易平台提供的各种用户标签作为 ADX 的一个辅助产品提供给各 DSP。标签一般按照 CPM 计价，DSP 如果选择购买某种标签，则在广告询价的过程中，ADX 将本次请求的用户标签 传给 DSP，最终按照 DSP 实际成交的展示量乘以 CPM 价格作为其购买数据的附加费用。

### 在线广告产品交互关系
从媒体角度来看，有以下三种产品可以帮助其变现流量：

1. 将广告位托管给广告网络，由广告网络决策广告投放，从赚取分成
2. 将广告位对接到广告交易平台，以实时竞价的方式变现
3. 将广告位托管给 SSP，这样可以同时对接多个广告网络和 PMP 接口， 并按照动态分配的逻辑选择变现最高的需求方

广告交易平台是相对比较中立的，在供给方和需求方之间提供公开、公平的流量交换 能力的平台产品。广告交易平台的流量可以来自于媒体、广告网络或 SSP，而需求方主要 对接 DSP 进行变现，某些情况下也可以让某些广告网络以优先或者打底的方式接入。

## 7、移动互联与原生广告
所有将商业化内容与非商业化内容统一生产或混合排序的产品都可以认为与 原生广告有关系，这样的产品方向经常被称为内容即广告(content as ad)。


### 原生广告相关产品
**1、信息流广告**

信息流广告起源于社交网络。信息流广告由于自然地出现在用户内 容消费的主路径上，而且展示形式与内容非常接近。

**2、搜索广告**

搜索广告的展示形式与自然搜索结果基本一致，也可以看成是存在于同一个信息流当中。搜索广告用一个明确的查询来触发广告。

搜索广告与内容的混合方式有两种，一种是将广告在固定的位置上展现，另一种是将 广告与内容混合排列在一起。

**3、软文广告**

软文广告是内容本身就是为了委婉地宣传某种产品而生产的。软文广告的生产和 传播过程很难被标准化，往往只适用于比较大的品牌广告主，不是产品化交易的对象。


**4、联盟**

由媒体从广告库中 自由选择要推广的对象，并按照自己控制的展现方式进行推广。

### 移动广告的现状与挑战
**移动广告的创意形式**

就目前市场来看，移动展示广告主要的创意形式有横幅、插屏、开屏、锁屏、 推荐墙、积分墙等。

**移动广告的挑战**

* 应用生态造成的行为数据割裂。
* 广告主移动化程度还不够
* 移动广告的产品形态需要一次革命。

### 原生广告平台

**表现原生与意图原生**

“原生”的概念有两种：一种是产品形式上的”原生“，另一种是用户意图上的“原生”。

表现上的原生性需要媒体来控制广告展示形式。意图上的原生性需要媒体明确提供广告需求。

**植入式原生广告**

广告平台提供的是结构化的付费内容。以植入式广告的逻辑来运营原生广告，是希望在内容生产的过程中，当某些片段商业
价值较高时，将这些内容按照严格的条件交由广告平台来生产。

### 原生广告与程序化交易
明确提供用户意图 的原生广告中，完全开放地进行 RTB，很难控制付费结果的相关性。

## 8、在线广告产品实践

从广告和泛广告变现的角度来看，在互联网市场上主要有三种资产能够变成钱，分别是数据、流量和品牌属性。

1. 媒体如何利用合适的广告产品更好地变现?
2. 广告主应选择何种广告平台，结合什么样的数据来完成高效的营销?
3. 拥有数据的第三方组织如何利用广告市场将自己的数据变成钱?

### 媒体实战
媒体的变现渠道无非是面向终端用户和面向客户两种。媒体利用广告市场的目的无非是获得收入。坚持利用高质量的广告变现有利于媒体长期保持和提升自己的品牌价值，从而在优先销售的广告 上获得更高的品牌溢价。

媒体选择合适的广告产品主要考虑以下几方面因素:是综合性媒体还是垂直媒体?媒 体的品牌价值如何?媒体的流量是否足够大?媒体是否有高价值的数据?

变现方式和产品决策

### 广告主实战
广告主指的是所有以付费方式推广自己的品牌、产品或内容的组织。

广告主对营销方式的选择，主要要考虑几方面的因素:是推广品牌还是直接销售?是 否有自己的第一方数据可以用于营销?对新客和老客的营销重点如何?

影响广告主在线营销推广方案的第一要素是推广的目的。

* 如果推广的目的为直接转化，也就是直接效果广告，那么先根据是否利用广告主自己的第一方数据做渠道来进行选择。
* 如果营销的目的是品牌推广而非直接转化，那么应该考虑一些以用户接触为主的合约 广告产品。

### 数据提供方实战
个组织拥有数据并不等于数据值得变现。在考虑数据变现之前，需要先对数据的价 值有合理的评估。评估的基本方式是“用户数×平均用户价值”。

大量数据通过广告市场的变现可以通过直接运营广告产品进行，也可以通过将数据售 卖给需求方进行。

## 9、计算广告技术概览
计算广告也是一个典型的个性化系统。个性化系统与搜索系统都是互联网时代具有挑战性的大规模计算问题。
广告系统搭建要充分利用开源社区的成熟工具快速搭建系统框架，把底层通信、资源分配、集群管理、跨语言调度等核心业务逻辑无关、但又有较高技术难度的部分用成熟方案来解决，广告系统的开发者就可以重点关注业务逻辑和核心算法。

### 个性化系统框架
个性化系统由四个主体部分构成

* 用于实时响应请求，完成决策的在线投放(online serving)引擎;
* 离线的分布式计算(distributed computing)数据处理平台;
* 用于在线实时反馈的流计算(stream computing)平台;
* 连接和转运以上三部分数据流的数据高速公路(data highway)。

在线投放系统的日志接入数据高速公路，再由数据高速公路快速转运到离线数据处理平台和在线流计算平台;离线数据处理平台周期性地以批处理方式加工过去一段时间的数据，得到人群标签和其他模型参数，存放在高速缓存中，供在线投放系统决策时使用;在线流计算平台则负责处理最近一小段时间的数据，得到准实时的用户标签和其他模型参数，也存放在高速缓存中，供在线投放系统决策时使用，这些是对离线处理结果的及时补充和调整。

由于个性化需要的是对用户尽可能准确的理解，因此除了个性化系统本身的日志，一般都还会用到其他的业务线数据或采买得到的数据，这些数据都会进入数据高速公路以及后续的加工流程中。

###  各类广告系统优化目标
广告系统的优化目标是提高广告产品的利润。

### 计算广告系统架构
```
广告投放机、日志系统(初始阶段)——>广告排序、用户行为反馈（优化阶段）——>各种检索功能（完善阶段）
```

广告系统的投放引擎采用类搜索的架构，即检索加排序的两阶段决策过程。
广告投放引擎主要有以下几个模块：

* 广告投放机(ad server)：与其他各个功能模块 打交道，并将它们串联起来完成在线广告投放决策。
* 广告检索(ad retrieval)：根据用户标签(user attributes) 与页面标签(page attributes)从广告索引(ad index)中查找符合条件的广告候选
* 广告排序(ad ranking)：在线高效地计算广告的 eCPM，并进行排序的模块。
* 收益管理(yield management)：统一代表在各种广告系统中将 局部广告排序的结果进一步调整，以全局收益最优为目的做调整的功能
* 广告请求接口
* 定制化用户划分(customized audience segmentation)

**离线数据处理**
离线数据处理有两 个输出目标:一是统计日志得到报表、dashboard 等，供决策人进行决策时作为参考;二是利用数据挖掘、机器学习技术进行受众定向、点击率预估、分配策略规划等，为在线的 机器决策提供支持。
离线数据处理有下面几个主要模块：

* 用户会话日志生成：从各个渠道收集的日志需要先整理成以用户ID为键的统一存储格式。
* 行为定向(behaviorial targeting)
* 上下文定向(contextual targeting)
* 点击率建模(click modeling)：在分布式计算平台上训练得到点击率的模型参数和相应特征(click model&features)，加载到缓存中供线上投放系统决策时使用。
* 分配规划(planning)：根据广告系 统全局优化的具体需求，利用离线日志数据进行规划，得到适合线上执行的分配方案
* 商业智能(business intelligence，BI)系统
* 广告管理系统

**在线数据处理**
在线数据处理是为了满足广告系统对实时数据反馈的要求，解决那些离线分布式计算平台无法快速响应的计算问题。在线数据处理主要包括以下模块：

* 在线反作弊(anti-spam)：实时判断流量来源中是否有作弊流量
* 计费(billing)
* 在线行为反馈，包括实时受众定向和实时点击反馈等部分
* 实时索引：实时接受广告投放数据， 建立倒排索引。

### 计算广告系统主要技术
从算法优化的角度看，主要有下面的一些问题，解决这些问题需要广泛用到机器学习、 数据挖掘等一些相关学科的技术。

* 特征提取，即对(a，u，c)打标签以方便后续建模和市场售卖的 问题，是计算广告中非常核心的受众定向问题
* 计算广告系统主要靠 eCPM 估计，特别是点击率预测来完成每一次展示时的局部优化。
* 在线分配的问题
* 确定合理的定价策略
* 个性化推荐技术

计算广告在系统架构方面涉及问题：

* 使用实时索引技术服务于广告候选的检索
* 用 NoSQL 数据库为投放时提供用户、上下文标签和其他特征
* 分布式计算平台进行大规模数据挖掘和建模
* 在广告交易市场中实现高并发、快速响应的实时竞价接口

### 用开源工具搭建计算广告系统
需要根据最小值原型(Minimum Value Prototype，MVP)的原则，低成本、短平快地搭建系统，然后在实际业务中进行快速迭代。利用成熟开源工具解决底层通信、 数据传输、负载分配等基础问题，从而将精力重点放在与业务逻辑相关的开发上。

Nginx、ZooKeeper、Lucene、Thrift、Flume、Hadoop、Redis、 Storm、Spark

## 10、基础知识准备

### 信息检索
**倒排索引**

倒排索引核心目的是将从大量文档中查找包含某些词的文档集合这一任务用 O(1)或O(log n)的时间复杂度完成， 其中n为索引中的文档数目。利用倒排索引技术，可以实现与文档集大小基本无关的检索复杂度。

倒排索引最基本的操作有两项:一是向索引中加入一个新文档，二是给定一个由多个 关键词组成的查询时，返回对应的文档集合。

**向量空间模型**

向量空间模型(Vector Space Model， VSM)的核心有两点:文档的表示方法和相似度计算方法。

### 最优化方法
最优化讨论的是在给定一个数学上明确表达的优化目标后，如何用系统性 的方法和思路找到该目标的最优解。

根据约束条件以及目标函数的性质不同，最优化问题求解的思路也有很大的不 同。其中无约束优化问题的方法是基础，而带约束优化问题则在一定条件下可以转化为无 约束优化问题来求解

* **拉格朗日法与凸优化**
* **下降单纯形法**
* **梯度下降法**
* **拟牛顿法**
* **Trust-Region 法**

### 统计机器学习
从机器学习的方法可以分为统计方法和非统计方法。

**最大熵与指数族分布**

统计机器学习中，指数族形式的分布由于求解的方便性，有非常重要的工程地位。最大熵原理告诉我们，当在某些约束条件下选 择统计模型时，需要尽可能选择满足这些条件的模型中不确定性最大的那个。

**混合模型和 EM 算法**

工程领域产生了采用多个指数 族分布叠加的部分来建模的实用方法，即混合模型(mixture model)

**贝叶斯学习**
最大似然准则是把模型 的参数看成固定的，然后找到使得训练数据上似然值最大的参数。

概率统计模型有两个常见任务:一是参数估计(parameter estimation)，二是预测 (prediction)。

### 统计模型分布式优化框架
对于大规模数据上的许多机器学习计算问题，MapReduce是一个可行的选择:因为在机器之间交换的数据只是统计量或者充分统计量，其空间复杂 度仅仅与模型的参数数目有关，与数据的多少并无直接关系。

## 11、合约广告核心技术
合约广告的关键特征是广告投放的价格和量由双方协商约定。合约广告的重点形式是按指定受众购买的、按 CPM 计费的展示量合约广告。展示量合 约广告的投送系统称为担保式投送系统。

### 广告排期系统
广告排期系统的一般技术方案是将广告素材按照预先确定的排期直接插入媒体页面，并通过内容分发网络(Content Delivery Network，CDN)加速访问。

### 担保式投送系统
担保式投送系统中，在线投放引擎接收用户触发的广告请求，根据用户标签和上下文标签找到可以匹配的广告合约，然后由在线分配模块 决定本次展示投放哪个广告。完成决策后，将展示和点击日志送入数据高速公路。这些日 志一方面进入离线分布式计算平台以后，通过日志的整理，完成合约的计划，即确定在线 分配算法的参数，再将分配方案送给线上投放机使用;另一方面，日志也送到流计算平台， 在反作弊和计价的基础上，再对索引进行快速调整。

**流量预测**

流量预测的问题可以描述为:给定一组受众标签组合以及一个 eCPM 的阈值，估算在 将来某个时间段内符合这些受众标签组合的条件、并且市场价在该 eCPM 阈值以下的广告 展示量。

流量预测一般的方法其实并不是预测，而是根据历史数据的统计来拟合未来的流量。

用反向检索的方案来进行流量预测，主要包括以下几个步骤。

1. 准备文档
2.  建立索引
3. 查询结果
4.  估算流量

**频次控制**

频次，指的是某个用户在一段时间内看到某个或某组广告的曝光次数。频次控制有客户端和服务器端两种解决方案。客户端的方案就是把某个用户对某个广告创意的频次值记录在浏览器 cookie 中，投放决策时再把这个值传给服务器来决策创意。服务器端的方案是在后台 设置一个专门用于频次记录和更新的缓存，当广告请求到来时，在缓存中查询候选广告的 频次，并根据最后实际投放的广告更新频次。

### 在线分配
在线分配问题指的是在通过对每一次广告展示进行实时在线决策，从而达到在满足某些量的约束的前提下，优化广告产品整体收益的过程。


## 12、受众定向核心技术
受众定向技术是对广告(a)、用户(u)、上下 文(c)这三个维度提取有意义的特征(这些特征也称为标签)的过程。

受众定向标签可以分成用户标签、上下文标签和广告主定制化标签 3 种类型。

上下文定向需要对广告所在的页面进行分析，结合广告对上下文信息的需求特点，一般可以采用一种半在线的方式抓取和分析页面，这种方式避免了无效的页面分析计算，又能够快速地响应需要分析的页面。

行为定向是根据用户历史上的网络访问行为对用户打标签的过程。哪些网络行为有价 值是挖掘行为数据来源时需要考虑的问题。行为定向一般采用 reach/CTR 曲线进行半定量的评价。

受众定向除了服务于广告产品外，也成为广告市场中相关数据产品的关键技术。

### 受众定向技术分类
受众定向技术可以分为以下三种类型。

1.  用户标签，即可以表示成 t(u)形式的标签，这是以用户历史行为数据为依据， 为用户打上的标签。
2. 上下文标签，即可以表示成 t(c) 形式的标签，这是根据用户当前的访问行为 得到的即时标签。
3. 定制化标签，根据广告主的某些属性或数据来加工

地域定向、频道定向和上下文定向属于 t(c)的定向方式;人口属性定向、行为定向属于 t(u)的定向方式;而重定向和新客推荐(look-alike)则是 t(a， u)的定向方式。

### 上下文定向
仅从打标签的方法上来看，上下文定向主要有以下几种思路：

* 用规则将页面归类到一些频道或主题分类。
* 提取页面中的关键词。
* 提取页面入链锚文本中的关键词。
* 提取页面流量来源中的搜索关键词。
* 用主题模型将页面内容映射到语义空间的一组主题上

确定了对上下文页面打标签的方法以后，在在线广告投放时，页面标签系统需要对广 告投放机查询的某一个URL快速返回其对应的标签。

**半在线抓取系统**

半在线抓取系统用一个缓存来保存每个 URL 对应的标签，当在线的广告请求到来时进行如下操作。

1. 如果该请求的上下文 URL 在缓存中存在，那么直接返回其对应的标签。
2. 如果该 URL 在服务中不存在，为了广告请求能及时得到处理，当时返回空的标 签集合，同时立刻向后台的抓取队列中加入此 URL。
3. 考虑到页面内容可能会不定期更新，可以设置缓存合适的 TTL(Time to Live) 以做到自动更新标签。

只要保证大多数的广告决策最优正常，很少量的次优决策甚至随机决策都是可以接受的。

**文本主题挖掘**

文本主题模型有两大类别:一 种是预先定义好主题的集合，用监督学习的方法将文档映射到这一集合的元素上;一种是 不预先定义主题集合，而是控制主题的总个数或聚类程度，用非监督学习的方法自动学习 出主题集合以及文档到这些主题的映射函数。

### 行为定向
行为定向可以描述为，根据某用户一段时期内的各种网络行为，将该用户映射到 某个定向标签上。

**行为定向建模问题**某个用户在某类广告上的点击量作为建模的对象。

**行为定向特征生成**实际上是调整各个标签类别上各种特征权重的过程。

**行为定向决策过程**不需要λ到 h 的泊松分布， 只需要计算线性函数 λ的值，然后根据预先确定的阈值来确定某个用户是否应该被打上某 个定向标签。

**行为定向的评测**可以通过 reach/CTR 曲线来进行半定量的评测。

### 人口属性预测
年龄、性别、教育程度、收入水平等人口属性并不属于用户的兴趣，而是用户确定的特点描述。

从用户行为上预测非性别的人口属性是比较困难的任务，除 非有非常相关的数据来源以及充分多的准确的训练样本，否则不太建议用这种方法获得这 些标签。

### 数据管理平台
数据管理平台(DMP)通过部署在媒体上的代码或 SDK 收集第一 方访问日志，送入数据高速公路。同时通过数据高速公路收集自有的第二方数据，然后把 这些日志原始行为映射到结构化或非结构化的受众标签体系上。


## 13、竞价广告核心技术
### 竞价广告计价算法
对于一个 CPC 结算的竞价广告系统，需要先得到广告候 选集合，并计算每个候选的点击率，这对应了竞价广告两个最关键的计算问题:广告检索和广告排序。

### 搜索广告系统
搜索广告是竞价广告中最典型的系统之一，上下文信息非常强，用户标签的作用受到很大的限制。搜索广告算法上最关键的技术是点击率预测。

* **查询扩展**
* **广告放置**

### 广告网络
广告网络的成本是分成或包断媒体资源。广告投放的决策流程为:服务器接收前 端用户访问触发的广告请求，首先根据上下文信息和用户身份标识从页面标签和用户标签 中查出相应的上下文标签和用户标签;然后用这些标签以及其他一些广告请求条件从广告 索引中找到符合要求的广告候选集合;最后，利用 CTR 预估模型计算所有的广告候选的 eCPM，再根据 eCPM 排序选出赢得竞价的广告，并返回给前端完成投放。

### 广告检索

**相关性检索**

### 点击率预测
广告点击率预测的目的是广告排序，但不能套用搜索里的排序问题:点击率预测不能 像搜索那样只要求结果排序的正确性，因为点击率需要乘以点击单价才得到最后的排序。

* **点击率预测模型**
* **优化算法**
* **点击率模型的校正**
* **点击率模型的特征**
* **点击率模型评测**
* **智能频次控制**



## 14、程序化交易核心技术

### 广告交易平台
广告交易平台的优化目标通过比较 DSP 报价，取价高者即可。

* **cookie 映射**
* **询价优化**

### 需求方平台
DSP 的优化从利润的角度出发，除了尽量提高广告 的 eCPM，还需要尽量降低每次广告展示的费用。

* **定制化用户标签**
* **DSP 中的点击率预测**
* **点击价值估计**
* **出价策略**

### 供给方平台
供给方平台会实现私有的RTB交易以及网络 优化等功能，并且用动态分配的逻辑决定当前展示分配给哪种广告渠道。

**网络优化**指 SSP在接入多个广告网络以后，在线动态决定将广告请求发给哪个 广告网络，从而优化整体收入的问题。

## 15、其他广告相关技术

###  创意优化

**程序化创意**为了提高用户的关注程度，需要将向用户推送此广告的关键原因在创意中明确表达出来。
> * 地域型创意
> * 搜索重定向创意
> * 个性化重定向创意

**点击热力图**是将某一个创意各位置被点击的密度用热力图的方式呈现出来，帮助创意优化者直 观地发现和解决其中的问题。

### 实验框架
无论是广告系统调整算法、架构，还是投放时调整创意、定向策略，都需要依赖线上的实际流量测试来确定其真实效果如何。实验框架需要尽可能多地同时容纳多组实验，以提高流量利用效率和产品进化速度。

设计这样一个实验系统的关键，是利用系统模块之间的相对独立性，用分层的结构来 扩展实验容量。


### 流量保护和效果监测
流量保护包括两方面的内容:一是对非主动用户访问行为，主要是爬虫行为的去除;二是反作弊，即对于恶意展示或流量来源的去除。

* **反作弊**：媒体作弊，广告平台作弊，广告主竞争对手作弊
* **广告监测**：
* **广告安全**

### 隐私保护和数据安全
无论是受众定向还是数据交易，都需要谨慎地考 虑对行为数据的使用是否会泄露用户的隐私;同时也要考虑拥有数据的利益方，特别是广 告主，是否在广告市场中被平台或竞争对手获得和利用了自己的关键商业数据。

* **隐私保护问题**
* **程序化交易中的数据安全**